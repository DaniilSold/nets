# NETS - Локальный сетевой и процессный монитор для Windows

## 🎯 Описание

**NETS** - это современное настольное приложение для Windows 10/11, которое обеспечивает комплексный мониторинг сетевой активности с глубокой интеграцией на уровне процессов и пользователей. Приложение работает полностью автономно, без передачи данных во внешнюю сеть, и предоставляет прозрачность всей сетевой активности на уровне хоста.

## ✨ Основные возможности

### 🔍 Мониторинг сетевых потоков (L2-L4)

- **Полный захват TCP/UDP соединений** - мониторинг всех входящих и исходящих соединений
- **IPv4 и IPv6 поддержка** - полная поддержка обеих версий протокола
- **5-tuple идентификация** - источник/назначение IP:Port + протокол
- **Направление потоков** - Inbound, Outbound, Lateral (внутри подсети)
- **Состояния TCP** - LISTEN, ESTABLISHED, TIME_WAIT и др.
- **Метрики** - количество байтов, пакетов, длительность соединения
- **Интерфейсы** - привязка к конкретному сетевому адаптеру

### 👤 Привязка к процессам и пользователям

Каждое сетевое соединение связывается с:
- **PID** (Process ID) и PPID (Parent Process ID)
- **Имя процесса** и полный путь к исполняемому файлу
- **SHA-256 хэш** бинарного файла (первые 16 символов)
- **Статус цифровой подписи** (подписан/не подписан)
- **Пользователь** (SID/username)
- **Командная строка** запуска

### 🌐 DNS-мониторинг

- **Локальные DNS-запросы** (UDP/TCP порт 53)
- **mDNS** (Multicast DNS, порт 5353)
- **LLMNR** (Link-Local Multicast Name Resolution, порт 5355)
- **Фиксация**:
  - QNAME (запрашиваемое имя домена)
  - QTYPE (тип запроса: A, AAAA, PTR, SRV, и т.д.)
  - RCODE (код ответа: NOERROR, NXDOMAIN, и т.д.)
  - Время выполнения запроса
  - Процесс-инициатор

### 🏠 Локальные протоколы

Детекция служебных протоколов локальной сети:
- **mDNS** (5353) - обнаружение сервисов Apple Bonjour
- **LLMNR** (5355) - разрешение имен Windows без DNS
- **NetBIOS-NS** (137) - служба имен NetBIOS
- **NetBIOS-DGM** (138) - датаграммы NetBIOS
- **NetBIOS-SSN** (139) - сеансы NetBIOS
- **SSDP** (1900) - обнаружение UPnP устройств
- **DHCP** (67/68) - автоконфигурация IP
- **SMB** (445) - файловый обмен Windows
- **RDP** (3389) - удаленный рабочий стол
- **Kerberos** (88) - аутентификация AD
- **LDAP/LDAPS** (389/636) - службы каталогов

### 🔒 TLS метаданные

Извлечение информации из TLS ClientHello (без расшифровки):
- **SNI** (Server Name Indication) - целевой домен
- **ALPN** (Application-Layer Protocol Negotiation) - протокол приложения
- **JA3/JA3S хэши** - отпечатки клиента/сервера

### 🚨 Аналитика и детекция аномалий

Автоматическое обнаружение подозрительной активности:

1. **Hidden Listeners** - скрытые слушающие сервисы
   - Неподписанные процессы на системных портах
   - Процессы вне системных директорий

2. **Port Scanning** - сканирование портов
   - Множественные подключения к разным портам за короткое время

3. **Lateral Movement** - боковое перемещение
   - SMB/RDP/LDAP соединения внутри локальной сети

4. **ARP Spoofing** - подмена ARP-записей
   - Изменение MAC-адреса для существующего IP

5. **Suspicious DNS** - аномальный DNS
   - Высокая частота неудачных запросов
   - DGA-подобные домены (Domain Generation Algorithm)

6. **Local Proxy/Tunnel** - локальные прокси и туннели
   - Неизвестные процессы на типичных proxy-портах (8080, 1080, 9050)

7. **Unexpected P2P** - неожиданные P2P соединения
   - Прямые подключения между локальными хостами

### 🎨 Современный UI в стиле Windows 11

- **Темная и светлая темы** - автоматическое переключение по системным настройкам
- **Адаптивный дизайн** - оптимизация под разные разрешения
- **Интерактивные таблицы** - сортировка, фильтрация, поиск
- **Графики трафика** - визуализация в реальном времени
- **Графы связей** - визуализация процесс ↔ endpoint
- **Всплывающие уведомления** - оповещения об аномалиях
- **Многоязычность** - русский и английский интерфейс

### 💾 Хранение и экспорт

- **SQLite база данных** - локальное хранение с шифрованием AES-GCM
- **Экспорт в JSON/CSV** - для анализа в сторонних инструментах
- **Экспорт PCAP** - для детального анализа в Wireshark
- **HTML отчеты** - для документирования инцидентов

### 🛡️ Управление и реагирование

Прямо из интерфейса можно:
- **Заблокировать соединение** - через Windows Firewall
- **Завершить процесс** - с подтверждением
- **Карантин процесса** - блокировка всех его соединений
- **Просмотр деталей** - полная информация о потоке

## 📋 Требования

### Системные требования
- Windows 10 (версия 1809+) или Windows 11
- x64 архитектура
- Минимум 4 ГБ RAM
- 500 МБ свободного места на диске

### Привилегии
Для полной функциональности требуются права администратора:
- ✅ Чтение расширенных TCP/UDP таблиц
- ✅ Доступ к информации о всех процессах
- ✅ Создание правил Windows Firewall
- ✅ Завершение процессов

## 🚀 Быстрый старт

### Установка через MSI

1. Скачайте последнюю версию `NETS-Setup-x64.msi` из [Releases](https://github.com/yourusername/nets/releases)
2. Запустите установщик **от имени администратора**
3. Следуйте инструкциям мастера установки
4. Запустите NETS из меню Пуск

### Сборка из исходников

```powershell
# Клонировать репозиторий
git clone https://github.com/yourusername/nets.git
cd nets

# Установить зависимости
cd app/ui
npm install

# Собрать приложение
cargo tauri build

# Установщик будет в: app/ui/src-tauri/target/release/bundle/msi/
```

## 📖 Использование

### Основной интерфейс

1. **Flows (Потоки)** - текущие сетевые соединения в реальном времени
2. **Alerts (Алерты)** - обнаруженные аномалии и угрозы
3. **DNS & Services** - DNS-запросы и обнаруженные сервисы
4. **Graph (Граф)** - визуализация связей процессов и endpoints
5. **Processes (Процессы)** - список активных процессов с сетевой активностью
6. **Settings (Настройки)** - конфигурация приложения

### Фильтрация

Мощная система фильтрации позволяет:
- Фильтровать по **протоколу** (TCP, UDP, ICMP)
- Фильтровать по **направлению** (Inbound, Outbound, Lateral)
- Фильтровать по **уровню риска** (Low, Medium, High)
- Фильтровать по **процессу** (имя или PID)
- Фильтровать по **портам** (одиночные или диапазоны: 80, 443, 8000-9000)

### Пресеты

Готовые наборы фильтров:
- **LAN Essentials** - фокус на ARP, DNS и локальные listeners
- **DNS Focus** - отслеживание NXDOMAIN и сервис-дискавери
- **Investigation** - максимальное хранение, подробные логи

### Детальный просмотр

Клик по соединению открывает детальную панель с:
- Полная сетевая информация (5-tuple, метрики)
- Информация о процессе (путь, хэш, подпись, пользователь)
- TLS метаданные (если применимо)
- DNS данные (если применимо)
- Layer 2 информация (ARP/ND)
- Оценка риска с обоснованием
- Доступные действия (блокировка, завершение)

## 🏗️ Архитектура

```
┌─────────────────────────────────────────────┐
│           UI Layer (Tauri + React)          │
│  ┌──────────┬──────────┬─────────────────┐  │
│  │  Flows   │  Alerts  │  DNS & Services │  │
│  │  Table   │  List    │  Views          │  │
│  └──────────┴──────────┴─────────────────┘  │
└─────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────┐
│         Analyzer (Rust)                     │
│  ┌─────────────────────────────────────┐    │
│  │  Anomaly Detector                   │    │
│  │  - Hidden Listeners                 │    │
│  │  - Port Scanning                    │    │
│  │  - Lateral Movement                 │    │
│  │  - DNS Anomalies                    │    │
│  └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────┐
│         Collector (Rust)                    │
│  ┌────────────────────────────────────┐     │
│  │  Windows Collector                 │     │
│  │  ├─ Network Monitor (IP Helper)    │     │
│  │  ├─ Process Info (PSAPI)           │     │
│  │  ├─ Protocol Detector              │     │
│  │  └─ Action Handler (Firewall)      │     │
│  └────────────────────────────────────┘     │
└─────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────┐
│    Windows API                              │
│  ┌────────────────────────────────────┐     │
│  │  IP Helper API (GetExtendedTcp...)  │     │
│  │  Process Status API (PSAPI)         │     │
│  │  Windows Firewall (netsh/WFP)       │     │
│  │  Security API (Token, SID)          │     │
│  └────────────────────────────────────┘     │
└─────────────────────────────────────────────┘
```

## 🔧 Конфигурация

Файл конфигурации: `%APPDATA%\NETS\config.toml`

```toml
[collector]
poll_interval = 2              # Интервал сбора (секунды)
max_flows = 2000               # Макс. потоков в памяти

[analyzer]
enable_anomaly_detection = true # Детекция аномалий
sensitivity = "medium"          # low, medium, high

[storage]
db_path = "%APPDATA%\\NETS\\flows.db"
encrypt = true                  # Шифрование БД
retention_days = 30             # Срок хранения

[network]
lan_only = false               # Только локальная сеть
ignore_loopback = true         # Игнорировать loopback

[ui]
language = "ru"                # Язык (en, ru)
theme = "auto"                 # light, dark, auto
refresh_interval = 1000        # Обновление UI (мс)
```

## 📊 Производительность

### Оптимизации
- Использование нативных Windows API вместо парсинга команд
- Batch-обработка соединений
- Кэширование информации о процессах
- Асинхронная архитектура на Tokio
- Эффективная буферизация данных

### Метрики
- **CPU**: < 5%
- **RAM**: < 40 МБ
- **Disk I/O**: минимальный
- **Flows/sec**: до 1000 при полной нагрузке

## 🔐 Безопасность

### Приватность
- ✅ Все данные хранятся локально
- ✅ Нет отправки данных в сеть
- ✅ Шифрование базы данных (AES-GCM)
- ✅ Контроль доступа к конфигурации

### Целостность
- ✅ Проверка цифровых подписей процессов
- ✅ Вычисление SHA-256 хэшей
- ✅ Валидация входных данных
- ✅ Защита от injection-атак

### Угрозы (STRIDE)
См. подробную угрозмодель в [docs/architecture.md](docs/architecture.md)

## 📚 Документация

- [Архитектура](docs/architecture.md) - общая архитектура проекта
- [Windows Features](docs/windows-features.md) - Windows-специфичные возможности
- [Deployment](docs/deployment-windows.md) - развертывание на Windows
- [Data Schemas](docs/data-schemas.md) - структуры данных и контракты
- [Test Plan](docs/test-plan.md) - план тестирования

## 🛠️ Разработка

### Структура проекта

```
nets/
├── app/
│   ├── collector/        # Сбор сетевых данных
│   │   └── src/
│   │       └── windows/  # Windows-специфичная реализация
│   ├── analyzer/         # Анализ и детекция аномалий
│   ├── normalizer/       # Нормализация данных
│   ├── storage/          # Хранение данных
│   ├── policy/           # Политики и действия
│   └── ui/              # Tauri + React UI
├── docs/                # Документация
├── rules/               # Правила детекции
├── scripts/             # Скрипты сборки и пакетирования
└── tests/               # Тесты
```

### Запуск в режиме разработки

```powershell
# Frontend
cd app/ui
npm run dev

# Backend
cargo tauri dev

# Тесты
cargo test --workspace
```

## 🤝 Вклад в проект

Мы приветствуем вклад в проект! См. [CONTRIBUTING.md](CONTRIBUTING.md) для деталей.

### Области для улучшения
- [ ] Полная интеграция с ETW (Microsoft-Windows-TCPIP provider)
- [ ] Разработка WFP callout драйвера
- [ ] Расширенный анализ JA3/JA3S
- [ ] Machine Learning для детекции аномалий
- [ ] Интеграция с Windows Defender ATP
- [ ] Поддержка DoH/DoT протоколов

## 📝 Лицензия

Этот проект лицензирован под [MIT License](LICENSE).

## 🙏 Благодарности

- [Tauri](https://tauri.app/) - кроссплатформенный фреймворк
- [Rust](https://www.rust-lang.org/) - системный язык программирования
- [React](https://reactjs.org/) - библиотека UI
- [Windows API](https://docs.microsoft.com/en-us/windows/) - нативные API Windows

## 📞 Поддержка

- **Issues**: [GitHub Issues](https://github.com/yourusername/nets/issues)
- **Discussions**: [GitHub Discussions](https://github.com/yourusername/nets/discussions)
- **Email**: support@example.com

---

**Сделано с ❤️ для Windows 10/11**
