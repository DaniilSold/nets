# ADR 0002: Linux datapath через eBPF/XDP

## Решение
Использовать eBPF программы (TC/XDP) с userspace чтением через perf/ring-buffer (`aya` crate).

## Контекст
* Требуется минимальная деградация сети и глубокий доступ к L2-L4 заголовкам.
* XDP обеспечивает раннюю точку захвата (до стека ядра).

## Альтернативы
* `libpcap` только — проще, но меньше контекста L2 и выше overhead копирования.
* Netfilter queue — добавляет latency.

## Обоснование
eBPF позволяет фильтровать трафик в ядре, отдавая в userspace только метаданные (metadata-first). Программы можно обновлять без перезагрузки.

## Последствия
* Необходимо управление правами (`CAP_BPF`, `CAP_NET_ADMIN`).
* Требуется pipeline сборки eBPF bytecode (clang/llc) и верификация.
* В fallback режиме используется libpcap.
